# Weather Bot

---


## Introduction
Bonjour ! </br>
Nous sommes une **√©quipe de trois lyc√©ens** ayant un **projet d'√©cole** √† sujet libre. Nous avons donc choisi de cr√©er un **bot twitter** qui **publie la m√©t√©o** d'une ville sp√©cifique. Le bot peut √©galement **changer sa photo de profil selon la m√©t√©o**.

‚ö†Ô∏è Le fichier [application.py](https://github.com/Timoleroux/Weather-Bot/blob/main/application.py) est en cours de d√©veloppement donc il est tr√®s probable que le code ne soit pas optimis√© et qu'il y ait quelques bugs.

## C'est quoi le but ?

Weather Bot est un **bot cod√© enti√®rement en python** qui permet de **poster des tweets** annon√ßant la **m√©t√©o** de n'importe quelle ville. On peut √©galement programmer un **emploi du temps** o√π chaque jour, un tweet se postera aux heures pr√©d√©finies.

---

## Pr√©requis pour lancer le script

**Attention :** *il est recommand√© d'ex√©cuter le script avec la **version 3.10** de [**Python**](https://www.python.org/downloads/) minimum.*
Pour t√©l√©charger le .zip, cliquez [ici](https://github.com/Timoleroux/Weather-Bot/archive/refs/heads/main.zip)

Pour traiter les donn√©es de Twitter, c'est le module [**Tweepy**](https://www.tweepy.org/) qui s'en charge. Pour y avoir acc√®s, il faut installer le module en ex√©cutant la commande :
    
    pip install tweepy

Il est √©galement n√©cessaire de poss√©der les tokens de Tweepy. Pour cela, il faut se rendre sur l'[espace d√©veloppeur](https://developer.twitter.com/en/portal/petition/essential/basic-info) de twitter et cr√©er un projet pour r√©cup√©rer les tokens n√©cessaires et les ajouter dans le fichier [ressources.py](https://github.com/Timoleroux/Weather-Bot/blob/main/ressources.py).

Pour traiter les donn√©es m√©t√©orologiques, c'est le module [**Pyowm**](https://pypi.org/project/pyowm/) qui s'en charge. Pour y avoir acc√®s, il faut installer le module en ex√©cutant la commande :

    pip install pyowm

Il est aussi n√©cessaire de poss√©der le token de Pyowm. Pour cela, il faut se cr√©er un compte sur [OWM](https://home.openweathermap.org/users/sign_up) puis, une fois connect√©, se rendre [ici](https://home.openweathermap.org/api_keys) o√π vous trouverez le token n√©cessaire que vous pourrez ajouter au fichier [ressources.py](https://github.com/Timoleroux/Weather-Bot/blob/main/ressources.py).

**Attention :** nous ne connaissons pas l'emplacement des stations m√©t√©o gr√¢ce auxquelles cette API va chercher les informations. Par cons√©quent, il est probable qu'il y ait des l√©g√®res diff√©rences avec les donn√©es fournies par des sites de m√©t√©o officiels.

Si les diff√©rences de donn√©es sont trop importantes, il est possible que la ville que vous avez entr√©e ait √©t√© confondue avec un autre endroit portant le m√™me nom *(Ex : la ville de Brest existe en France et en Bi√©lorussie)*.

---
## Documentation des fonctions

### ressources.py/AuthTweepy

    AuthTweepy()

Cette fonction permet d'**authentifier la connexion √† Tweepy** et donc d'utiliser cette API. Voir la [doc officielle](https://docs.tweepy.org/en/stable/).

### ressources.py/AuthPyowm

    AuthPyowm()

Cette fonction permet d'**authentifier la connexion √† Pyowm** et donc d'utiliser cette API. Voir la [doc officielle](https://pyowm.readthedocs.io/en/latest/).

### ressources.py/currentTime

    currentTime()
    Input : '%d/%m/%Y %H:%M:%S'
    Output : 05/11/2022 19:00:00

Cette fonction prend en entr√©e une chaine de caract√®res qui d√©finit le format de l'heure qui sera retourn√©e en sortie de la forme choisie.

| Commande |  Fran√ßais  |  Anglais  |
|:--------:|:----------:|:---------:|
|   `%Y`   |   Ann√©e    |   Year    |
|   `%m`   |    Mois    |   Month   |
|   `%d`   |    Jour    |    Day    |
|   `%H`   |   Heure    |   Hour    |
|   `%M`   |   Minute   |  Minute   |
|   `%S`   |  Seconde   |  Second   |

### main.py/allWeatherInfos

    allWeatherInfos()
    Input : 'Paris'
    Output : ['Paris', '05/11/2022', '19h00', 'nuageux', 10, 9, 16.67]

Cette fonction prend en entr√©e un **nom de ville** sous forme de **string**.
Gr√¢ce √† Pyowm, elle retourne une liste contenant les informations suivantes (ou `False` si la ville n'est pas valide) :
1. La **ville** qui a √©t√© entr√©e *(string)*
2. La **date du jour** sous la forme : JJ/MM/AAAA *(string)*
3. L'**heure du jour** sous la forme : 23h59 *(string)*
4. La **m√©t√©o** *(string)*
5. La **temp√©rature** de la ville *(int)*
6. Le **ressenti** de cette temp√©rature *(int)*
7. La **vitesse du vent** dans cette ville *(float)*

### main.py/updateProfilPicture

    updateProfilPicture()
    Input : 'nuageux'
    Output : True

Cette fonction prend en entr√©e le 4<sup>√®me</sup> √©l√©ment de la liste pr√©c√©dente (la m√©t√©o). </br>
Si l'entr√©e fait partie des cas cit√©s dans la fonction, alors elle change la photo de profil du bot et retourne `True`. </br>
Si l'entr√©e ne fait pas partie des cas cit√©s dans la fonction, alors elle affiche dans la console ¬´ Aucune photo de profil correspond √† {m√©t√©o} pour le moment. ¬ª et retourne `False`.

### main.py/publishTweet

    publishTweet()
    Input : ['Paris', '05/11/2022', '19h00', 'nuageux', 10, 9, 16.67]
    Output : Voici la m√©t√©o pour Paris, le 05/11/2022 √† 19h00:
                ‚òÄÔ∏è Temps : nuageux
                üå°Ô∏è Temp√©rature moyenne : 10¬∞C (ressenti 9¬∞C)
                üí® Vitesse du vent : 16.67 km/h

Cette fonction prend en entr√©e la liste de donn√©es que retourne la fonction [`allWeatherInfos()`](#mainpyallweatherinfos). </br>
Elle publie un tweet gr√¢ce √† la liste qui lui a √©t√© donn√©e. Si l'op√©ration r√©ussit, elle retourne le tweet sinon elle retourne `False`.

### main.py/manualRun

    manualRun()
    Input : None
    Output : True

Cette fonction prend entr√©e une ville sous forme de **string**. </br>
Elle publie le Tweet gr√¢ce correspondant et change la photo de profil selon la m√©t√©o gr√¢ce aux fonctions pr√©c√©dentes. </br>
Elle affiche un message de log lorsque le Tweet est publi√© (dans la console et dans le fichier [main.log](https://github.com/Timoleroux/Weather-Bot/blob/main/main.log))</br>
Si l'op√©ration r√©ussit elle retourne `True`.

### main.py/makeSchedulesValid

    makeSchedulesValid()
    Input : ['8h', '12:30', '25h30']
    Output : ['08h00', '12h30']

Cette fonction prend en ent√©e une liste d'horaires.
Elle formate les horaires de mani√®re conforme pour pouvoir √™tre lu par [main.py](#mainpyautorun)
Elle retourne la liste d'horaires format√©e et si cette liste est vide, elle retourne `False`.

### main.py/autoRun

    autoRun()
    Input : ['08h00', '12h00', '20h30']
    Output : None

Cette fonction prend entr√©e une ville sous forme de **string** et une liste d'horaires. </br>
Gr√¢ce √† la fonction pr√©c√©dente, elle formate correctement la liste d'horaire et s'il n'y en a aucun valide, elle retourne `False`.
Ensuite, chaque jour, pour chacun des horaires de la liste, elle publie le tweet contenant la m√©t√©o correspondant √† la ville choisie.</br>
Puis elle affiche un message de log lorsque le Tweet est publi√© (dans la console et dans le fichier [main.log](https://github.com/Timoleroux/Weather-Bot/blob/main/main.log))</br>

---
## Documentation des erreurs communes

La plupart du temps, l'erreur suivante est caus√©e par les tokens √©crits dans le fichier [ressources.py](https://github.com/Timoleroux/Weather-Bot/blob/main/ressources.py) qui sont incorrects.

    tweepy.errors.Unauthorized: 401 Unauthorized
    32 - Could not authenticate you.

Si vous obtenez l'erreur suivante, c'est que le Tweet que vous essayez de publier existe d√©j√†.

    tweepy.errors.Forbidden: 403 Forbidden
    187 - Status is a duplicate.

Souvent, l'erreur suivante est due au nom de la ville qui n'est pas valide.

    pyowm.commons.exceptions.NotFoundError: Unable to find the resource

En g√©n√©ral, ce genre d'erreur est due √† un programme externe (du type antivirus) qui bloque les connexions avec les modules.

    pyowm.commons.exceptions.InvalidSSLCertificateError:
